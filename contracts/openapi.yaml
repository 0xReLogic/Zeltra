openapi: 3.1.0
info:
  title: Zeltra API
  description: B2B Expense & Budgeting Engine API
  version: 0.1.0
  
servers:
  - url: http://localhost:8080/api/v1
    description: Local development
  - url: https://api.zeltra.io/api/v1
    description: Production

tags:
  - name: Auth
    description: Authentication & session management
  - name: Organizations
    description: Organization & user management
  - name: Accounts
    description: Chart of accounts
  - name: Transactions
    description: Ledger transactions
  - name: Budgets
    description: Budget management
  - name: Reports
    description: Financial reports
  - name: Simulation
    description: Budget simulation engine

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      
  schemas:
    # ============ Common ============
    Error:
      type: object
      required: [error]
      properties:
        error:
          type: object
          required: [code, message]
          properties:
            code:
              type: string
              example: VALIDATION_ERROR
            message:
              type: string
              example: Invalid request body
            details:
              type: object
            request_id:
              type: string
              format: uuid
              
    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 50
        total:
          type: integer
          example: 150
        total_pages:
          type: integer
          example: 3
          
    Money:
      type: string
      pattern: '^-?\d+\.\d{4}$'
      description: Decimal string with 4 decimal places
      example: "1000.0000"
      
    # ============ Auth ============
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
          
    LoginResponse:
      type: object
      required: [user, access_token, refresh_token, expires_in]
      properties:
        user:
          $ref: '#/components/schemas/User'
        access_token:
          type: string
        refresh_token:
          type: string
        expires_in:
          type: integer
          description: Seconds until access_token expires
          example: 3600
          
    RegisterRequest:
      type: object
      required: [email, password, full_name]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        full_name:
          type: string
          minLength: 2
          
    RefreshRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string
          
    # ============ User ============
    User:
      type: object
      required: [id, email, full_name, created_at]
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        full_name:
          type: string
        organizations:
          type: array
          items:
            $ref: '#/components/schemas/UserOrganization'
        created_at:
          type: string
          format: date-time
          
    UserOrganization:
      type: object
      required: [id, name, slug, role]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        role:
          $ref: '#/components/schemas/UserRole'
          
    UserRole:
      type: string
      enum: [owner, admin, accountant, approver, viewer, submitter]
      
    # ============ Organization ============
    Organization:
      type: object
      required: [id, name, slug, base_currency, timezone, created_at]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        base_currency:
          type: string
          pattern: '^[A-Z]{3}$'
          example: USD
        timezone:
          type: string
          example: Asia/Jakarta
        subscription_tier:
          type: string
          enum: [starter, growth, enterprise]
        subscription_status:
          type: string
          enum: [trialing, active, past_due, cancelled, expired]
        created_at:
          type: string
          format: date-time
          
    CreateOrganizationRequest:
      type: object
      required: [name, slug, base_currency]
      properties:
        name:
          type: string
        slug:
          type: string
          pattern: '^[a-z0-9-]+$'
        base_currency:
          type: string
          pattern: '^[A-Z]{3}$'
        timezone:
          type: string
          default: UTC
          
    # ============ Account ============
    Account:
      type: object
      required: [id, code, name, account_type, currency, is_active]
      properties:
        id:
          type: string
          format: uuid
        code:
          type: string
          example: "5100"
        name:
          type: string
          example: Marketing Expense
        account_type:
          $ref: '#/components/schemas/AccountType'
        account_subtype:
          $ref: '#/components/schemas/AccountSubtype'
        currency:
          type: string
        parent_id:
          type: string
          format: uuid
          nullable: true
        is_active:
          type: boolean
        allow_direct_posting:
          type: boolean
        balance:
          $ref: '#/components/schemas/Money'
          
    AccountType:
      type: string
      enum: [asset, liability, equity, revenue, expense]
      
    AccountSubtype:
      type: string
      enum:
        - cash
        - bank
        - accounts_receivable
        - inventory
        - prepaid
        - fixed_asset
        - accumulated_depreciation
        - other_asset
        - accounts_payable
        - credit_card
        - accrued_liability
        - short_term_debt
        - long_term_debt
        - other_liability
        - owner_equity
        - retained_earnings
        - common_stock
        - other_equity
        - operating_revenue
        - other_revenue
        - cost_of_goods_sold
        - operating_expense
        - payroll_expense
        - depreciation_expense
        - interest_expense
        - tax_expense
        - other_expense

    CreateAccountRequest:
      type: object
      required: [code, name, account_type]
      properties:
        code:
          type: string
          example: "1101"
        name:
          type: string
          example: "Petty Cash"
        account_type:
          $ref: '#/components/schemas/AccountType'
        account_subtype:
          $ref: '#/components/schemas/AccountSubtype'
        parent_id:
          type: string
          format: uuid
          nullable: true
        is_active:
          type: boolean
          default: true
        currency:
          type: string
          example: USD
        
    # ============ Transaction ============
    Transaction:
      type: object
      required: [id, transaction_type, transaction_date, description, status, entries, created_at]
      properties:
        id:
          type: string
          format: uuid
        reference_number:
          type: string
          nullable: true
        transaction_type:
          $ref: '#/components/schemas/TransactionType'
        transaction_date:
          type: string
          format: date
        description:
          type: string
        memo:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/TransactionStatus'
        fiscal_period:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
        entries:
          type: array
          items:
            $ref: '#/components/schemas/LedgerEntry'
        created_by:
          $ref: '#/components/schemas/UserSummary'
        approved_by:
          $ref: '#/components/schemas/UserSummary'
          nullable: true
        posted_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
          
    TransactionType:
      type: string
      enum: [journal, expense, invoice, bill, payment, transfer, adjustment, opening_balance, reversal]
      
    TransactionStatus:
      type: string
      enum: [draft, pending, approved, posted, voided]
      
    LedgerEntry:
      type: object
      required: [id, account_id, source_currency, source_amount, functional_amount, debit, credit]
      properties:
        id:
          type: string
          format: uuid
        account_id:
          type: string
          format: uuid
        account_code:
          type: string
        account_name:
          type: string
        source_currency:
          type: string
        source_amount:
          $ref: '#/components/schemas/Money'
        exchange_rate:
          type: string
          example: "1.0850000000"
        functional_currency:
          type: string
        functional_amount:
          $ref: '#/components/schemas/Money'
        debit:
          $ref: '#/components/schemas/Money'
        credit:
          $ref: '#/components/schemas/Money'
        memo:
          type: string
          nullable: true
        dimensions:
          type: array
          items:
            $ref: '#/components/schemas/DimensionValue'
            
    CreateTransactionRequest:
      type: object
      required: [transaction_type, transaction_date, description, entries]
      properties:
        transaction_type:
          $ref: '#/components/schemas/TransactionType'
        transaction_date:
          type: string
          format: date
        description:
          type: string
        reference_number:
          type: string
        memo:
          type: string
        entries:
          type: array
          minItems: 2
          items:
            $ref: '#/components/schemas/CreateEntryRequest'
            
    CreateEntryRequest:
      type: object
      required: [account_id, source_currency, source_amount, entry_type]
      properties:
        account_id:
          type: string
          format: uuid
        source_currency:
          type: string
          pattern: '^[A-Z]{3}$'
        source_amount:
          type: string
          description: Decimal string
          example: "1000.00"
        entry_type:
          type: string
          enum: [debit, credit]
        memo:
          type: string
        dimensions:
          type: array
          items:
            type: string
            format: uuid
          description: Array of dimension_value_ids
          
    UserSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        full_name:
          type: string
          
    # ============ Dimensions ============
    DimensionType:
      type: object
      required: [id, code, name, is_required, is_active]
      properties:
        id:
          type: string
          format: uuid
        code:
          type: string
          example: DEPARTMENT
        name:
          type: string
          example: Department
        is_required:
          type: boolean
        is_active:
          type: boolean
        sort_order:
          type: integer
          
    DimensionValue:
      type: object
      required: [id, code, name]
      properties:
        id:
          type: string
          format: uuid
        dimension_type:
          type: string
        code:
          type: string
          example: ENG
        name:
          type: string
          example: Engineering
        parent_id:
          type: string
          format: uuid
          nullable: true
        is_active:
          type: boolean
          
    # ============ Fiscal Period ============
    FiscalYear:
      type: object
      required: [id, name, start_date, end_date, status]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: FY 2026
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        status:
          type: string
          enum: [OPEN, CLOSED]
        periods:
          type: array
          items:
            $ref: '#/components/schemas/FiscalPeriod'
            
    FiscalPeriod:
      type: object
      required: [id, name, period_number, start_date, end_date, status]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: January 2026
        period_number:
          type: integer
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        status:
          type: string
          enum: [OPEN, SOFT_CLOSE, CLOSED]
        is_adjustment_period:
          type: boolean
          
    # ============ Reports ============
    TrialBalance:
      type: object
      required: [report_type, as_of, currency, accounts, totals]
      properties:
        report_type:
          type: string
          example: trial_balance
        as_of:
          type: string
          format: date
        currency:
          type: string
        accounts:
          type: array
          items:
            type: object
            properties:
              account_id:
                type: string
                format: uuid
              code:
                type: string
              name:
                type: string
              account_type:
                $ref: '#/components/schemas/AccountType'
              debit:
                $ref: '#/components/schemas/Money'
              credit:
                $ref: '#/components/schemas/Money'
              balance:
                $ref: '#/components/schemas/Money'
        totals:
          type: object
          properties:
            total_debit:
              $ref: '#/components/schemas/Money'
            total_credit:
              $ref: '#/components/schemas/Money'
            is_balanced:
              type: boolean
              
    # ============ Dashboard ============
    DashboardMetrics:
      type: object
      properties:
        period:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
        cash_position:
          type: object
          properties:
            balance:
              $ref: '#/components/schemas/Money'
            currency:
              type: string
            change_from_last_period:
              $ref: '#/components/schemas/Money'
            change_percent:
              type: number
        burn_rate:
          type: object
          properties:
            daily:
              $ref: '#/components/schemas/Money'
            monthly:
              $ref: '#/components/schemas/Money'
        runway_days:
          type: integer
        pending_approvals:
          type: object
          properties:
            count:
              type: integer
            total_amount:
              $ref: '#/components/schemas/Money'

    CashFlowDataPoint:
      type: object
      required: [month, inflow, outflow]
      properties:
        month:
          type: string
          description: Month label (e.g., "Jan", "Feb")
        inflow:
          type: number
          format: float
          description: Total cash inflow for the month
        outflow:
          type: number
          format: float
          description: Total cash outflow for the month

    ActivityItem:
      type: object
      required: [id, type, action, entity_type, entity_id, timestamp]
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum: [transaction_created, transaction_submitted, transaction_approved, transaction_rejected, transaction_posted, transaction_voided, budget_created, budget_updated, budget_locked, user_invited, user_role_changed]
        action:
          type: string
        entity_type:
          type: string
          enum: [transaction, budget, user]
        entity_id:
          type: string
          format: uuid
        description:
          type: string
        amount:
          $ref: '#/components/schemas/Money'
        currency:
          type: string
        user:
          type: object
          properties:
            id:
              type: string
              format: uuid
            full_name:
              type: string
        metadata:
          type: object
        timestamp:
          type: string
          format: date-time

security:
  - bearerAuth: []

paths:
  # ============ Auth ============
  /auth/register:
    post:
      tags: [Auth]
      summary: Register new user
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
                
  /auth/login:
    post:
      tags: [Auth]
      summary: Login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
                
  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
                
  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout
      responses:
        '204':
          description: Logged out

  /auth/verify-email:
    post:
      tags: [Auth]
      summary: Verify email address
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token]
              properties:
                token:
                  type: string
                  description: Verification token from email
      responses:
        '200':
          description: Email verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  verified:
                    type: boolean
        '400':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/resend-verification:
    post:
      tags: [Auth]
      summary: Resend verification email
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Verification email sent (if account exists)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Email already verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          
  # ============ Organizations ============
  /organizations:
    get:
      tags: [Organizations]
      summary: List user's organizations
      responses:
        '200':
          description: List of organizations
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Organization'
    post:
      tags: [Organizations]
      summary: Create organization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrganizationRequest'
      responses:
        '201':
          description: Organization created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'
                
  # ============ Accounts ============
  /accounts:
    get:
      tags: [Accounts]
      summary: List accounts
      parameters:
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/AccountType'
        - name: active
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: List of accounts
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Account'

    post:
      tags: [Accounts]
      summary: Create new account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAccountRequest'
      responses:
        '201':
          description: Account created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'

  /accounts/{id}:
    get:
      tags: [Accounts]
      summary: Get account detail
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Account detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
    put:
      tags: [Accounts]
      summary: Update account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAccountRequest'
      responses:
        '200':
          description: Account updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
    delete:
      tags: [Accounts]
      summary: Delete account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Account deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                      
  # ============ Transactions ============
  /transactions:
    get:
      tags: [Transactions]
      summary: List transactions
      parameters:
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/TransactionStatus'
        - name: from
          in: query
          schema:
            type: string
            format: date
        - name: to
          in: query
          schema:
            type: string
            format: date
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: List of transactions
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    post:
      tags: [Transactions]
      summary: Create transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTransactionRequest'
      responses:
        '201':
          description: Transaction created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '400':
          description: Validation error (unbalanced, period closed, etc)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
                
  /transactions/{id}:
    get:
      tags: [Transactions]
      summary: Get transaction detail
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Transaction detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
    patch:
      tags: [Transactions]
      summary: Update draft transaction
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTransactionRequest'
      responses:
        '200':
          description: Transaction updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
    delete:
      tags: [Transactions]
      summary: Delete draft transaction
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Transaction deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                
  /transactions/{id}/submit:
    post:
      tags: [Transactions]
      summary: Submit for approval
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Submitted
          
  /transactions/{id}/approve:
    post:
      tags: [Transactions]
      summary: Approve transaction
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Approved
          
  /transactions/{id}/post:
    post:
      tags: [Transactions]
      summary: Post to ledger
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Posted

  /transactions/{id}/reject:
    post:
      tags: [Transactions]
      summary: Reject transaction
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reason]
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Rejected

  /transactions/{id}/void:
    post:
      tags: [Transactions]
      summary: Void transaction
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reason]
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Voided
          
  # ============ Reports ============
  /reports/trial-balance:
    get:
      tags: [Reports]
      summary: Trial balance report
      parameters:
        - name: as_of
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Trial balance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrialBalance'
                
  # ============ Dashboard ============
  /dashboard/metrics:
    get:
      tags: [Reports]
      summary: Dashboard metrics
      parameters:
        - name: period_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Dashboard metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardMetrics'

  /dashboard/cash-flow:
    get:
      tags: [Reports]
      summary: Cash flow data for charts
      parameters:
        - name: period_id
          in: query
          schema:
            type: string
            format: uuid
        - name: months
          in: query
          schema:
            type: integer
            default: 6
            maximum: 12
      responses:
        '200':
          description: Cash flow data points
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CashFlowDataPoint'

  /dashboard/recent-activity:
    get:
      tags: [Reports]
      summary: Recent activity log
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            maximum: 50
        - name: type
          in: query
          schema:
            type: string
            enum: [all, transaction, budget, approval]
            default: all
      responses:
        '200':
          description: Recent activity list
          content:
            application/json:
              schema:
                type: object
                properties:
                  activities:
                    type: array
                    items:
                      $ref: '#/components/schemas/ActivityItem'
                  pagination:
                    type: object
                    properties:
                      limit:
                        type: integer
                      has_more:
                        type: boolean
                      next_cursor:
                        type: string

  # ============ Fiscal Periods ============
  /fiscal-years:
    get:
      tags: [Fiscal]
      summary: List fiscal years with periods
      responses:
        '200':
          description: List of fiscal years
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FiscalYear'
    post:
      tags: [Fiscal]
      summary: Create fiscal year with auto-generated periods
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, start_date, end_date]
              properties:
                name:
                  type: string
                  example: "FY 2026"
                start_date:
                  type: string
                  format: date
                end_date:
                  type: string
                  format: date
                period_frequency:
                  type: string
                  enum: [monthly, quarterly]
                  default: monthly
      responses:
        '201':
          description: Fiscal year created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FiscalYear'

  /fiscal-periods/{id}/status:
    patch:
      tags: [Fiscal]
      summary: Update fiscal period status
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [OPEN, SOFT_CLOSE, CLOSED]
      responses:
        '200':
          description: Period status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FiscalPeriod'

  # ============ Currencies & Exchange Rates ============
  /currencies:
    get:
      tags: [Currencies]
      summary: List all currencies
      responses:
        '200':
          description: List of currencies
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        code:
                          type: string
                          example: USD
                        name:
                          type: string
                          example: US Dollar
                        symbol:
                          type: string
                          example: $
                        decimal_places:
                          type: integer
                          example: 2

  /exchange-rates:
    get:
      tags: [Currencies]
      summary: Get exchange rate for currency pair
      parameters:
        - name: from
          in: query
          required: true
          schema:
            type: string
        - name: to
          in: query
          required: true
          schema:
            type: string
        - name: date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Exchange rate
          content:
            application/json:
              schema:
                type: object
                properties:
                  from_currency:
                    type: string
                  to_currency:
                    type: string
                  rate:
                    type: string
                  effective_date:
                    type: string
                    format: date
    post:
      tags: [Currencies]
      summary: Create or update exchange rate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [from_currency, to_currency, rate, effective_date]
              properties:
                from_currency:
                  type: string
                to_currency:
                  type: string
                rate:
                  type: number
                effective_date:
                  type: string
                  format: date
      responses:
        '201':
          description: Exchange rate created

  /exchange-rates/bulk:
    post:
      tags: [Currencies]
      summary: Bulk import exchange rates
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [rates]
              properties:
                rates:
                  type: array
                  items:
                    type: object
                    properties:
                      from:
                        type: string
                      to:
                        type: string
                      rate:
                        type: number
                      date:
                        type: string
                        format: date
      responses:
        '201':
          description: Rates imported
          content:
            application/json:
              schema:
                type: object
                properties:
                  imported:
                    type: integer
                  failed:
                    type: integer

  # ============ Dimensions ============
  /dimension-types:
    get:
      tags: [Dimensions]
      summary: List dimension types
      responses:
        '200':
          description: List of dimension types
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DimensionType'
    post:
      tags: [Dimensions]
      summary: Create dimension type
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code, name]
              properties:
                code:
                  type: string
                name:
                  type: string
                is_required:
                  type: boolean
                  default: false
      responses:
        '201':
          description: Dimension type created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DimensionType'

  /dimension-values:
    get:
      tags: [Dimensions]
      summary: List dimension values
      parameters:
        - name: type
          in: query
          schema:
            type: string
        - name: active
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: List of dimension values
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DimensionValue'
    post:
      tags: [Dimensions]
      summary: Create dimension value
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [dimension_type_id, code, name]
              properties:
                dimension_type_id:
                  type: string
                  format: uuid
                code:
                  type: string
                name:
                  type: string
                parent_id:
                  type: string
                  format: uuid
      responses:
        '201':
          description: Dimension value created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DimensionValue'

  # ============ Account Balance & Ledger ============
  /accounts/{id}/balance:
    get:
      tags: [Accounts]
      summary: Get account balance at date
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: as_of
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Account balance
          content:
            application/json:
              schema:
                type: object
                properties:
                  account_id:
                    type: string
                    format: uuid
                  account_code:
                    type: string
                  balance:
                    $ref: '#/components/schemas/Money'
                  currency:
                    type: string
                  as_of:
                    type: string
                    format: date-time

  /accounts/{id}/ledger:
    get:
      tags: [Accounts]
      summary: Get account ledger entries
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: from
          in: query
          schema:
            type: string
            format: date
        - name: to
          in: query
          schema:
            type: string
            format: date
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Ledger entries
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        transaction_id:
                          type: string
                          format: uuid
                        transaction_date:
                          type: string
                          format: date
                        description:
                          type: string
                        debit:
                          $ref: '#/components/schemas/Money'
                        credit:
                          $ref: '#/components/schemas/Money'
                        running_balance:
                          $ref: '#/components/schemas/Money'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  # ============ Organization Users ============
  /organizations/{id}:
    patch:
      tags: [Organizations]
      summary: Update organization settings
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                base_currency:
                  type: string
                timezone:
                  type: string
      responses:
        '200':
          description: Organization updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'

  /organizations/{id}/users:
    get:
      tags: [Organizations]
      summary: List organization users
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        user_id:
                          type: string
                          format: uuid
                        email:
                          type: string
                        full_name:
                          type: string
                        role:
                          $ref: '#/components/schemas/UserRole'
                        approval_limit:
                          $ref: '#/components/schemas/Money'
    post:
      tags: [Organizations]
      summary: Invite user to organization
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, role]
              properties:
                email:
                  type: string
                  format: email
                role:
                  $ref: '#/components/schemas/UserRole'
                approval_limit:
                  type: number
      responses:
        '201':
          description: User invited

  /organizations/{orgId}/users/{userId}:
    patch:
      tags: [Organizations]
      summary: Update user role
      parameters:
        - name: orgId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  $ref: '#/components/schemas/UserRole'
                approval_limit:
                  type: number
      responses:
        '200':
          description: User updated
    delete:
      tags: [Organizations]
      summary: Remove user from organization
      parameters:
        - name: orgId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User removed

  # ============ Reports ============
  /reports/balance-sheet:
    get:
      tags: [Reports]
      summary: Balance sheet report
      parameters:
        - name: as_of
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Balance sheet

  /reports/income-statement:
    get:
      tags: [Reports]
      summary: Income statement (P&L) report
      parameters:
        - name: from
          in: query
          schema:
            type: string
            format: date
        - name: to
          in: query
          schema:
            type: string
            format: date
        - name: dimension
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Income statement

  /reports/dimensional:
    get:
      tags: [Reports]
      summary: Dimensional report
      parameters:
        - name: from
          in: query
          schema:
            type: string
            format: date
        - name: to
          in: query
          schema:
            type: string
            format: date
        - name: group_by
          in: query
          schema:
            type: string
            description: Comma-separated dimension types
        - name: account_type
          in: query
          schema:
            $ref: '#/components/schemas/AccountType'
      responses:
        '200':
          description: Dimensional report

  # ============ Budgets ============
  /budgets:
    get:
      tags: [Budgets]
      summary: List budgets
      parameters:
        - name: fiscal_year_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of budgets
    post:
      tags: [Budgets]
      summary: Create budget
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, fiscal_year_id]
              properties:
                name:
                  type: string
                fiscal_year_id:
                  type: string
                  format: uuid
                budget_type:
                  type: string
                  enum: [annual, quarterly, monthly]
                currency:
                  type: string
      responses:
        '201':
          description: Budget created

  /budgets/{id}:
    get:
      tags: [Budgets]
      summary: Get budget detail
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Budget detail

  /budgets/{id}/lines:
    post:
      tags: [Budgets]
      summary: Add budget lines
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [lines]
              properties:
                lines:
                  type: array
                  items:
                    type: object
                    properties:
                      account_id:
                        type: string
                        format: uuid
                      fiscal_period_id:
                        type: string
                        format: uuid
                      amount:
                        type: number
                      dimensions:
                        type: array
                        items:
                          type: string
                          format: uuid
      responses:
        '201':
          description: Budget lines added

  /budgets/{id}/lock:
    post:
      tags: [Budgets]
      summary: Lock budget
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Budget locked

  /budgets/{id}/vs-actual:
    get:
      tags: [Budgets]
      summary: Budget vs actual comparison
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: period_id
          in: query
          schema:
            type: string
            format: uuid
        - name: dimension
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Budget vs actual data

  /dashboard/budget-vs-actual:
    get:
      tags: [Reports]
      summary: Dashboard budget vs actual summary
      deprecated: true
      description: |
        **Deprecated**: Frontend uses `GET /budgets` data directly for budget vs actual charts.
        This endpoint may be removed in future versions.
      parameters:
        - name: period_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Budget vs actual summary for dashboard
